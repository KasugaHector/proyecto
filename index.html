<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Mapa del Tren Ligero </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0057B8 0%, #565656 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: #565656;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        h2 {
            font-size: 1.5rem;
            color: #f5f5f5;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #ffffff;
            max-width: 800px;
            line-height: 1.5;
        }
        
        .scan-section {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 800px;
            text-align: center;
            box-shadow: 0 10px 30px #0057B8(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .camera-container {
            margin: 20px auto;
            width: 100%;
            max-width: 500px;
            position: relative;
        }
        
        #cameraView {
            width: 100%;
            height: 300px;
            border-radius: 15px;
            background-color: #000;
            object-fit: cover;
            display: none;
        }
        
        .camera-placeholder {
            width: 100%;
            height: 300px;
            border-radius: 15px;
            background-color: rgba(0, 0, 0, 0.3);
            border: 3px dashed #0057B8;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #565656;
            font-size: 1.2rem;
        }
        
        .camera-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }
        
        .scan-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .scan-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            height: 40%;
            border: 3px solid ##0057B8;
            border-radius: 10px;
            animation: pulse-frame 2s infinite;
        }
        
        @keyframes pulse-frame {
            0% { box-shadow: 0 0 0 0 #0057B8(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(1, 118, 252, 0.575); }
            100% { box-shadow: 0 0 0 0 rgba(6, 176, 228, 0); }
        }
        
        .camera-controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        .camera-button {
            background: linear-gradient(to right, #314d9b, #1a3a8f);
            color: #1d3d96;
            border: none;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 160px;
            justify-content: center;
        }
        
        .camera-button:hover {
            background: linear-gradient(to right, #0057B8, #2c86ec);
            transform: scale(1.05);
        }
        
        .camera-button:active {
            transform: scale(0.98);
        }
        
        .camera-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .stop-button {
            background: linear-gradient(to right, #f44336, #d32f2f);
        }
        
        .stop-button:hover {
            background: linear-gradient(to right, #d32f2f, #b71c1c);
        }
        
        .demo-button {
            background: linear-gradient(to right, #4CAF50, #2E7D32);
        }
        
        .demo-button:hover {
            background: linear-gradient(to right, #2E7D32, #1B5E20);
        }
        
        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            font-size: 1rem;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .status-success {
            background-color: rgba(76, 175, 80, 0.2);
            color: #a5d6a7;
        }
        
        .status-error {
            background-color: rgba(255, 43, 28, 0.2);
            color: #ef9a9a;
        }
        
        .status-scanning {
            background-color: rgba(33, 150, 243, 0.2);
            color: #90caf9;
        }
        
        .map-section {
            width: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 1s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .map-container {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            width: 100%;
            max-width: 900px;
            margin-top: 20px;
        }
        
        .map-title {
            color: #565656;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        
        .map-image {
            width: 100%;
            border-radius: 10px;
            border: 2px solid #ddd;
        }
        
        .instructions {
            background-color: #565656(0, 0, 0, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            width: 100%;
            max-width: 900px;
            text-align: center;
        }
        
        .instructions h3 {
            color: #000000;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .instructions p {
            line-height: 1.6;
            margin-bottom: 15px;
            color: #e6e6e6;
        }
        
        .step {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .step-number {
            background-color: #1a3a8f;
            color: #565656;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .back-button {
            background-color: #1a398f8a(255, 255, 255, 0.1);
            color: #1a3a8f;
            border: 1px solid rgba(13, 2, 61, 0.705);
            padding: 12px 30px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .compatibility-notice {
            background-color: rgba(255, 193, 7, 0.2);
            border-left: 4px solid #07ffa0;
            padding: 12px;
            border-radius: 5px;
            margin-top: 25px;
            font-size: 0.9rem;
            color: #ffecb3;
            width: 100%;
        }
        
        .demo-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
        }
        
        .qr-instructions {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            text-align: left;
        }
        
        .qr-instructions h4 {
            color: #1a3a8f;
            margin-bottom: 10px;
        }
        
        footer {
            margin-top: 40px;
            text-align: center;
            color: rgba(255, 255, 255, 0.692);
            font-size: 0.9rem;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .scan-section {
                padding: 20px;
            }
            
            #cameraView, .camera-placeholder {
                height: 250px;
            }
            
            .map-container, .instructions {
                padding: 15px;
            }
            
            .camera-icon {
                font-size: 3rem;
            }
            
            .camera-button {
                min-width: 140px;
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1> Mapa del Tren Ligero CDMX </h1>
            <p class="subtitle"> Escanea Tu Tarjeta de Movilidad CDMX</p>
        </header>
        
        <section class="scan-section">
            <h2>Escanear Tarjeta De Movilidad CDMX</h2>
            <p>Usa la c√°mara de tu dispositivo para escanear tu tarjeta</p>
            
            <div class="camera-container">
                <div class="camera-placeholder" id="cameraPlaceholder">
                    <div class="camera-icon">üì∑</div>
                    <p>C√°mara desactivada</p>
                </div>
                <video id="cameraView" playsinline></video>
                <div class="scan-overlay">
                    <div class="scan-frame"></div>
                </div>
            </div>
            
            <div class="camera-controls">
                <button class="camera-button" id="startCamera">
                    <span>‚ñ∂</span> Activar C√°mara
                </button>
                <button class="camera-button stop-button" id="stopCamera" disabled>
                    <span>‚èπ</span> Detener C√°mara
                </button>
                <button class="camera-button demo-button" id="demoButton">
                    <span>üîÑ</span> Modo Demostraci√≥n
                </button>
            </div>
            
            <div class="status-message" id="statusMessage">
                Activa la c√°mara y enfoca el c√≥digo QR de tu tarjeta del Metro CDMX
            </div>
            
            <div class="qr-instructions">
                <h4>Instrucciones para el escaneo:</h4>
                <p>1. Activa la c√°mara con el bot√≥n "Activar C√°mara"</p>
                <p>2. Enfoca el c√≥digo QR de tu tarjeta del Metro dentro del marco verde</p>
                <p>3. El sistema detectar√° autom√°ticamente el c√≥digo QR</p>
                <p>4. Si no tienes una tarjeta f√≠sica, usa el "Modo Demostraci√≥n"</p>
            </div>
            
            <div class="compatibility-notice">
                <strong>Nota:</strong> Necesitas permitir el acceso a la c√°mara en tu navegador. 
                Funciona mejor en dispositivos con c√°mara trasera de buena calidad.
            </div>
        </section>
        
        <section class="map-section" id="mapSection">
            <div class="map-container">
                <h2 class="map-title">Mapa del Tren Ligero de la Ciudad de M√©xico</h2>
                <img src="assets/linea_trenligero.jpg" alt="Mapa del Tren Ligero CDMX" class="map-image" id="mapImage">
            </div>
            
            <div class="instructions">
                <h3>Informaci√≥n Del Tren Ligero </h3>
                <p> El Tren Ligero forma parte de la red del Servicio de Transportes El√©ctricos de la CDMX, el cual opera en el Sur de la Ciudad de M√©xico. Presta servicio de transporte no contaminante a la poblaci√≥n de las Delegaciones Coyoac√°n, Tlalpan y Xochimilco, brindando su servicio a trav√©s de 16 estaciones y 2 terminales, mediante 20 trenes dobles acoplados con doble cabina de mando con capacidad m√°xima de 374 pasajeros por unidad. Cuenta con una l√≠nea de 13,04 kil√≥metros. </p>
                
                <div class="step">
                    <div class="step-number">1</div>
                    <div>Estaci√≥n Terminal: Xochimilco </div>
                </div>
                
                <div class="step">
                    <div class="step-number">2</div>
                    <div> Estaci√≥n Terminal: Tasque√±a </div>
                </div>
                
                <p> lunes a viernes: de 5:00 a 00:00 hrs
                    S√°bado: de 6:00 a 00:00 hrs
                    Domingo: de 7:00 a 00:00 hrs
                    El √∫ltimo tren sale de cada terminal a las 23:30 </p>
                
                <div class="step" id="cardInfo" style="display: none;">
                    <div class="step-number">‚Ñπ</div>
                    <div id="cardData">Informaci√≥n de la tarjeta escaneada aparecer√° aqu√≠</div>
                </div>
            </div>
            
            <button class="back-button" id="backButton">Regresar al Esc√°ner</button>
        </section>
        
        <footer>
            <p>Proyecto para concurso con mind.js ‚Ä¢ Sistema de escaneo por c√°mara de tarjeta del Metro CDMX</p>
            <p>Uso experimental - Para fines de demostraci√≥n del concurso</p>
        </footer>
    </div>

    <script>
        // Elementos del DOM
        const startCameraButton = document.getElementById('startCamera');
        const stopCameraButton = document.getElementById('stopCamera');
        const demoButton = document.getElementById('demoButton');
        const cameraView = document.getElementById('cameraView');
        const cameraPlaceholder = document.getElementById('cameraPlaceholder');
        const statusMessage = document.getElementById('statusMessage');
        const mapSection = document.getElementById('mapSection');
        const backButton = document.getElementById('backButton');
        const mapImage = document.getElementById('mapImage');
        const cardInfo = document.getElementById('cardInfo');
        const cardData = document.getElementById('cardData');
        
        // Variables para control de la c√°mara
        let cameraStream = null;
        let isCameraActive = false;
        let qrScanner = null;
        
        // Verificar compatibilidad con API de c√°mara
        function checkCameraSupport() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                statusMessage.textContent = "Tu navegador no soporta acceso a la c√°mara";
                statusMessage.className = "status-message status-error";
                startCameraButton.disabled = true;
                return false;
            }
            return true;
        }
        
        // Activar c√°mara
        async function startCamera() {
            if (!checkCameraSupport()) return;
            
            try {
                // Solicitar permiso para usar la c√°mara
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment', // Preferir c√°mara trasera
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                });
                
                // Mostrar video de la c√°mara
                cameraView.srcObject = cameraStream;
                cameraView.style.display = 'block';
                cameraPlaceholder.style.display = 'none';
                
                // Esperar a que el video est√© listo
                await cameraView.play();
                
                isCameraActive = true;
                startCameraButton.disabled = true;
                stopCameraButton.disabled = false;
                statusMessage.textContent = "C√°mara activada. Enfoca el c√≥digo QR de tu tarjeta del Metro CDMX";
                statusMessage.className = "status-message status-scanning";
                
                // Iniciar detecci√≥n de c√≥digos QR
                startQRCodeDetection();
                
            } catch (error) {
                console.error("Error al acceder a la c√°mara:", error);
                statusMessage.textContent = "Error al activar la c√°mara: " + error.message;
                statusMessage.className = "status-message status-error";
                isCameraActive = false;
            }
        }
        
        // Detener c√°mara
        function stopCamera() {
            if (cameraStream) {
                // Detener todas las pistas de video
                cameraStream.getTracks().forEach(track => {
                    track.stop();
                });
                cameraStream = null;
            }
            
            if (cameraView.srcObject) {
                cameraView.srcObject = null;
            }
            
            cameraView.style.display = 'none';
            cameraPlaceholder.style.display = 'flex';
            
            isCameraActive = false;
            startCameraButton.disabled = false;
            stopCameraButton.disabled = true;
            statusMessage.textContent = "C√°mara desactivada. Act√≠vala para escanear el c√≥digo QR";
            statusMessage.className = "status-message";
            
            // Detener detecci√≥n de QR
            if (qrScanner) {
                clearInterval(qrScanner);
                qrScanner = null;
            }
        }
        
        // Iniciar detecci√≥n de c√≥digos QR (simulaci√≥n)
        function startQRCodeDetection() {
            // En un sistema real, aqu√≠ usar√≠as una librer√≠a como jsQR o QuaggaJS
            // Para esta demo, simularemos la detecci√≥n despu√©s de un tiempo
            
            // Simular que estamos buscando c√≥digos QR
            let scanAttempts = 0;
            const maxScanAttempts = 20; // Simular 20 intentos antes de fallar
            
            qrScanner = setInterval(() => {
                if (!isCameraActive) {
                    clearInterval(qrScanner);
                    return;
                }
                
                scanAttempts++;
                
                // Simular diferentes estados de escaneo
                if (scanAttempts === 3) {
                    statusMessage.textContent = "Buscando c√≥digo QR...";
                } else if (scanAttempts === 6) {
                    statusMessage.textContent = "Ajustando enfoque...";
                } else if (scanAttempts === 9) {
                    statusMessage.textContent = "C√°mara lista para escanear";
                }
                
                // Simular detecci√≥n exitosa despu√©s de cierto tiempo
                if (scanAttempts >= 10 && scanAttempts <= maxScanAttempts) {
                    // 30% de probabilidad de detecci√≥n en cada intento despu√©s del intento 10
                    if (Math.random() < 0.3) {
                        simulateQRCodeDetected();
                        clearInterval(qrScanner);
                        return;
                    }
                }
                
                // Si llegamos al m√°ximo de intentos sin detectar, sugerir modo demo
                if (scanAttempts >= maxScanAttempts) {
                    statusMessage.textContent = "No se detect√≥ c√≥digo QR. Aseg√∫rate de enfocar bien el c√≥digo o usa el modo demostraci√≥n";
                    statusMessage.className = "status-message status-error";
                    clearInterval(qrScanner);
                }
            }, 500); // Intentar cada 500ms
        }
        
        // Simular que se detect√≥ un c√≥digo QR
        function simulateQRCodeDetected() {
            // Generar datos simulados de tarjeta
            const cardTypes = ["Tarjeta del Metro CDMX", "Tarjeta Recargable Metro", "Tarjeta Estudiante CDMX"];
            const cardType = cardTypes[Math.floor(Math.random() * cardTypes.length)];
            const cardUID = generateCardUID();
            const balance = (Math.random() * 50 + 5).toFixed(2);
            const lastUse = new Date().toLocaleDateString('es-MX');
            const trips = Math.floor(Math.random() * 15);
            
            // Mostrar mensaje de √©xito
            statusMessage.textContent = `‚úì C√≥digo QR detectado: Tarjeta ${cardUID.substring(0, 8)}`;
            statusMessage.className = "status-message status-success";
            
            // Detener c√°mara
            stopCamera();
            
            
            // Mostrar el mapa despu√©s de un breve retraso
            setTimeout(() => {
                showMap();
            }, 1500);
        }
        
        // Generar un UID de tarjeta simulado
        function generateCardUID() {
            const chars = '0123456789ABCDEF';
            let uid = '';
            for (let i = 0; i < 16; i++) {
                uid += chars[Math.floor(Math.random() * chars.length)];
                if (i % 4 === 3 && i < 15) uid += ':';
            }
            return uid;
        }
        
        // Mostrar el mapa del Tren Ligero
        function showMap() {
            mapSection.style.display = 'flex';
            document.querySelector('.scan-section').style.display = 'none';
            
            // Efecto de carga de la imagen del mapa
            mapImage.style.opacity = '0';
            setTimeout(() => {
                mapImage.style.transition = 'opacity 1s ease';
                mapImage.style.opacity = '1';
            }, 100);
        }
        
        // Funci√≥n para volver al esc√°ner
        function goBackToScanner() {
            mapSection.style.display = 'none';
            document.querySelector('.scan-section').style.display = 'block';
            cardInfo.style.display = "none";
            statusMessage.textContent = "Activa la c√°mara y enfoca el c√≥digo QR de tu tarjeta del Metro CDMX";
            statusMessage.className = "status-message";
        }
        
        // Modo de demostraci√≥n (sin c√°mara)
        function demoMode() {
            // Detener c√°mara si est√° activa
            if (isCameraActive) {
                stopCamera();
            }
            
            // Generar datos de demostraci√≥n
            const demoData = {
                cardType: "Tarjeta del Metro CDMX (Modo Demostraci√≥n)",
                cardUID: "4A:3B:2C:1D:EF:89:01:23",
                balance: "24.50",
                lastUse: new Date().toLocaleDateString('es-MX'),
                trips: "8"
            };
            

            ;
            
            statusMessage.textContent = "‚úì Modo demostraci√≥n activado - Tarjeta simulada escaneada";
            statusMessage.className = "status-message status-success";
            
            // Mostrar el mapa despu√©s de un breve retraso
            setTimeout(() => {
                showMap();
            }, 800);
        }
        
        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar compatibilidad con c√°mara
            checkCameraSupport();
            
            // Event Listeners
            startCameraButton.addEventListener('click', startCamera);
            stopCameraButton.addEventListener('click', stopCamera);
            demoButton.addEventListener('click', demoMode);
            backButton.addEventListener('click', goBackToScanner);
            
            // Atajos de teclado
            document.addEventListener('keydown', (event) => {
                if (event.code === 'KeyC' && !event.ctrlKey && !isCameraActive) {
                    event.preventDefault();
                    startCamera();
                }
                
                if (event.code === 'Escape' && isCameraActive) {
                    stopCamera();
                }
                
                if (event.code === 'KeyD' && event.ctrlKey) {
                    event.preventDefault();
                    demoMode();
                }
            });
            
            // Detener c√°mara al salir de la p√°gina
            window.addEventListener('beforeunload', () => {
                if (isCameraActive) {
                    stopCamera();
                }
            });
        });
        
    </script>
</body>
</html>


